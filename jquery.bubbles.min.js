/*
*   jquery.bubbles.js
*   Custom Google Maps Info Windows
*   Copyright (c) 2010 timmy willison
*   Dual licensed under the MIT and GPL licenses.
*   http://timmywillison.com/licence/
*/
(function(g){var m,p=function(){return new m.init(arguments)};m=p.prototype={opts:{center:{lat:36.915,lng:-95.225},markers:[{lat:35.289,lng:-94.756,title:"woot",content:'<div class="iw-content"><p>Hello World!!</p></div>'}],markerIcon:"images/google-maps-icon.png",markerShadow:"images/google-maps-shadow.png",windowImage:"images/google-maps-infobox.png",closeImage:"images/google-maps-close.png",offsetVertical:-226,offsetHorizontal:-20,iwWidth:208,iwHeight:165},init:function(b){b=Array.prototype.slice.call(b);
this.mapEl=g(b.shift());this.opts.map=new google.maps.Map(this.mapEl[0],{zoom:4,scrollwheel:0,center:new google.maps.LatLng(this.opts.center.lat,this.opts.center.lng),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,navigationControlOptions:{style:google.maps.NavigationControlStyle.ZOOM_PAN}});g.extend(this.opts,b[0]||{});this.setMarkers(this.opts.map,this.opts.markers)},setMarkers:function(b,a){for(var c=0;c<a.length;c++)this.attachInfo(b,a[c])},attachInfo:function(b,a){b=this.opts.map;
var c=a.title,h=this.opts.markerIcon,f=this.opts.markerShadow,i=a.content,j=new google.maps.LatLng(a.lat,a.lng),e=new google.maps.Marker({position:j,map:b,title:c,icon:h,shadow:f}),d=this.opts;google.maps.event.addListener(e,"click",function(){new k({latlng:e.getPosition(),map:b,content:i,offsetVertical:d.offsetVertical,offsetHorizontal:d.offsetHorizontal,height:d.iwHeight,width:d.iwWidth,windowImage:d.windowImage,closeImage:d.closeImage})})}};m.init.prototype=m;var k=function(b){var a=this;google.maps.OverlayView.call(a);
a.latlng=b.latlng;a.map=b.map;a.content=b.content;a.offsetVertical=b.offsetVertical;a.offsetHorizontal=b.offsetHorizontal;a.height=b.height;a.width=b.width;a.windowImage=b.windowImage;a.closeImage=b.closeImage;a.boundsChangedListener=google.maps.event.addListener(a.map,"bounds_changed",function(){return a.panMap.apply(a)});a.setMap(this.map)};k.prototype=new google.maps.OverlayView;k.prototype.createElement=function(){var b=this.getPanes(),a=this.div_;if(a)a.parentNode!=b.floatPane&&a.remove().appendTo(b.floatPane);
else{a=this.div_=g("<div/>").css({border:"0 none",position:"absolute",background:"url("+this.windowImage+") no-repeat top left",width:this.width,height:this.height,padding:"10px 20px 30px 20px"});var c=g("<div/>").css({textAlign:"right",marginBottom:"-5px"}),h=g("<img/>").css({width:11,height:11,cursor:"pointer"}).attr("src",this.closeImage).appendTo(c);google.maps.event.addDomListener(h[0],"click",function(f){return function(){f.setMap(null)}}(this));c.appendTo(a);g(this.content).appendTo(a);a.remove().appendTo(b.floatPane);
this.panMap()}};k.prototype.panMap=function(){var b=this.map,a=b.getBounds();if(a){var c=this.latlng,h=this.width,f=this.height,i=this.offsetHorizontal,j=this.offsetVertical,e=b.getDiv(),d=e.offsetWidth;e=e.offsetHeight;var l=a.toSpan(),n=l.lng(),o=l.lat();l=n/d;o=o/e;e=a.getSouthWest().lng();n=a.getNorthEast().lng();d=a.getNorthEast().lat();a=a.getSouthWest().lat();var q=c.lng()+(i-40)*l;i=c.lng()+(i+h+40)*l;h=c.lat()-(j-40)*o;c=c.lat()-(j+f+40)*o;f=(q<e?e-q:0)+(i>n?n-i:0);c=(h>d?d-h:0)+(c<a?a-c:
0);j=b.getCenter();f=j.lng()-f;c=j.lat()-c;b.setCenter(new google.maps.LatLng(c,f));google.maps.event.removeListener(this.boundsChangedListener);this.boundsChangedListener=null}};k.prototype.draw=function(){this.createElement();var b=this.getProjection().fromLatLngToDivPixel(this.latlng);g(this.div_).css({width:this.width,left:b.x+this.offsetHorizontal,height:this.height,top:b.y+this.offsetVertical,display:"block"})};k.prototype.remove=function(){if(this.div_.size())div_=this.div_.detach()};g.fn.bubbles=
function(){var b=Array.prototype.slice.call(arguments);this.each(function(){b.unshift(this);p.apply(null,b)});return this}})(jQuery);
